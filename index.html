<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Amazon ODR Visualization & Calculator</title>

<!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
:root {
  --bg-color: #000;
  --text-color: #fff;
  --card-bg: #111;
  --bar-clean: #66ff66;
  --bar-defective: #ff6666;
  --dot-clean: #66ff66;
  --dot-defective: #ff6666;
  --neon-clean: #00ff00;
  --neon-defective: #ff0000;
}

body { font-family: Arial, sans-serif; background: var(--bg-color); color: var(--text-color); padding: 20px; }
h1, h2 { text-align: center; }

.top-row { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; margin-bottom: 40px; }
.calculator, .text-section {
  background: var(--card-bg); padding: 20px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  flex: 1 1 350px; min-width: 300px;
}

.animation-section {
  width: 100%; background: var(--card-bg); padding: 20px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  text-align: center;
}

.bar-container { display: flex; align-items: flex-end; flex-wrap: wrap; max-width: 100%; margin: 0 auto; justify-content: center; }
.bar, .dot, .neon-dot { margin: 1px; transition: all 0.3s; }

.bar { width: 20px; }
.bar.clean { background: var(--bar-clean); }
.bar.defective { background: var(--bar-defective); }

.dot { width: 15px; height: 15px; border-radius: 50%; display: inline-block; }
.dot.clean { background: var(--dot-clean); }
.dot.defective { background: var(--dot-defective); }

.neon-dot { width: 15px; height: 15px; border-radius: 50%; display: inline-block; box-shadow: 0 0 5px #fff,0 0 10px #fff,0 0 15px #0ff,0 0 20px #0ff; }
.neon-dot.clean { background: var(--neon-clean); box-shadow: 0 0 5px var(--neon-clean),0 0 10px var(--neon-clean),0 0 15px var(--neon-clean),0 0 20px var(--neon-clean); }
.neon-dot.defective { background: var(--neon-defective); box-shadow: 0 0 5px var(--neon-defective),0 0 10px var(--neon-defective),0 0 15px var(--neon-defective),0 0 20px var(--neon-defective); }

.highlight { color: var(--bar-defective); font-weight: bold; }
.step { margin: 10px 0; }
ul { padding-left: 20px; }
.tiny-note { font-size: 0.8em; color: #aaa; margin-top: 2px; }

.theme-select { display: flex; align-items: center; gap: 5px; margin-bottom: 10px; }

input.form-control,
select.form-select,
textarea.form-control {
  background-color: var(--card-bg);
  color: var(--text-color);
  border: 1px solid #444;
  transition: all 0.3s;
}

input.form-control:focus,
select.form-select:focus,
textarea.form-control:focus {
  border-color: var(--bar-clean);
  box-shadow: 0 0 5px rgba(0, 255, 0, 0.3);
}

button.btn { transition: all 0.3s; }
</style>
</head>
<body>

<h1>Amazon ODR Visualization & Calculator</h1>

<div class="top-row">
  <div class="calculator">
    <h2>ODR Calculator</h2>

    <div class="theme-select">
      <label for="themeSelect">Theme:</label>
      <select id="themeSelect" class="form-select">
        <option value="light">ðŸŒž Light</option>
        <option value="dark">ðŸŒš Dark</option>
        <option value="cyberpunk">ðŸ¤– Cyberpunk</option>
        <option value="solaris">ðŸŒ… Solaris</option>
      </select>
      <div class="tiny-note">Your choice will be remembered until cookies/cache are cleared.</div>
    </div>

    <p>Enter your metrics to calculate your current ODR and see how many additional perfect orders you need to reach your target.</p>
    <form id="odrForm">
      <label for="totalOrdersInput">Total Orders:</label>
      <input type="number" id="totalOrdersInput" class="form-control" min="1" required>

      <label for="defectiveOrdersInput">Defective Orders:</label>
      <input type="number" id="defectiveOrdersInput" class="form-control" min="0" required>

      <label for="targetODRInput">Target ODR (%):</label>
      <input type="number" id="targetODRInput" class="form-control" min="0" max="100" step="0.01" value="1" required>

      <label for="displayType">Display Type:</label>
      <select id="displayType" class="form-select mb-1">
        <option value="bars">Bars</option>
        <option value="dots">Dots</option>
        <option value="neon">Glowing Neon Dots</option>
      </select>

      <button type="submit" class="btn btn-success mt-2">Calculate</button>
    </form>
    <div class="results mt-3" id="results"></div>

    <div class="mt-3 d-flex gap-2">
      <button class="btn btn-primary" data-bs-toggle="offcanvas" data-bs-target="#historyDrawer">
        History
      </button>
      <button id="downloadHistory" class="btn btn-success">
        Download History
      </button>
    </div>
  </div>

  <div class="text-section">
    <h2>Step-by-Step Explanation & Fix</h2>
    <div class="info">
      <div class="step"><strong>Step 1:</strong> Enter your metrics in the calculator on the left to calculate your ODR.</div>
      <div class="step"><strong>Step 2:</strong> Formula: <span class="highlight">ODR = defective orders Ã· total orders Ã— 100%</span></div>
      <div class="step"><strong>Step 3:</strong> Calculate additional clean orders needed: <pre>ODR â‰¤ target â‡’ defective orders / (total orders + X) â‰¤ target</pre></div>
      <div class="step"><strong>Step 4:</strong> Resolve defective orders ASAP and ensure future orders are perfect.</div>
    </div>
  </div>
</div>

<div class="animation-section">
  <h2 id="dynamicHeader">Orders Visualization</h2>
  <div class="bar-container" id="barContainer"></div>
</div>

<div class="offcanvas offcanvas-start" tabindex="-1" id="historyDrawer">
  <div class="offcanvas-header">
    <h5 class="offcanvas-title">Calculation History</h5>
    <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas"></button>
  </div>
  <div class="offcanvas-body">
    <table class="table table-striped" id="historyTable">
      <thead>
        <tr>
          <th>#</th>
          <th>Timestamp</th>
          <th>Total Orders</th>
          <th>Defective</th>
          <th>Target ODR</th>
          <th>Additional Orders Needed</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
const container = document.getElementById('barContainer');
const dynamicHeader = document.getElementById('dynamicHeader');
let bars = [];
let interval;

// --- Animate bars/dots/neon ---
function animateOrders(totalOrders, defectiveOrders, type) {
  container.innerHTML = '';
  bars = [];
  clearInterval(interval);

  dynamicHeader.innerHTML = `You have <span style="color: var(--bar-defective)">${defectiveOrders}</span> defective orders out of <span style="color: var(--bar-clean)">${totalOrders}</span> total orders`;

  for(let i=0; i<totalOrders; i++){
    const elem = document.createElement('div');
    if(type === 'bars'){
      elem.classList.add('bar', i < defectiveOrders ? 'defective' : 'clean');
      elem.style.height = '10px';
    } else if(type === 'dots'){
      elem.classList.add('dot', i < defectiveOrders ? 'defective' : 'clean');
    } else if(type === 'neon'){
      elem.classList.add('neon-dot', i < defectiveOrders ? 'defective' : 'clean');
    }
    container.appendChild(elem);
    bars.push(elem);
  }

  if(type === 'bars'){
    let step = 0;
    interval = setInterval(() => {
      if(step >= totalOrders){ clearInterval(interval); return; }
      bars[step].style.height = '100px';
      step++;
    }, 10);
  }
}

// --- Load saved display type ---
const displaySelect = document.getElementById('displayType');
const savedType = localStorage.getItem('displayType');
if(savedType) displaySelect.value = savedType;
displaySelect.addEventListener('change', () => { localStorage.setItem('displayType', displaySelect.value); });

// --- Theme switching ---
const themeSelect = document.getElementById('themeSelect');
let savedTheme = localStorage.getItem('theme');
if(!savedTheme){
  savedTheme = 'dark'; // default dark
  localStorage.setItem('theme','dark');
}
setTheme(savedTheme);
themeSelect.value = savedTheme;

themeSelect.addEventListener('change', () => {
  setTheme(themeSelect.value);
  localStorage.setItem('theme', themeSelect.value);
});

function setTheme(theme){
  switch(theme){
    case 'light':
      document.documentElement.style.setProperty('--bg-color', '#f0f4f8');
      document.documentElement.style.setProperty('--text-color', '#000');
      document.documentElement.style.setProperty('--card-bg', '#fff');
      document.documentElement.style.setProperty('--bar-clean', '#4caf50');
      document.documentElement.style.setProperty('--bar-defective', '#f44336');
      document.documentElement.style.setProperty('--dot-clean', '#4caf50');
      document.documentElement.style.setProperty('--dot-defective', '#f44336');
      document.documentElement.style.setProperty('--neon-clean', '#00ff00');
      document.documentElement.style.setProperty('--neon-defective', '#ff0000');
      break;
    case 'dark':
      document.documentElement.style.setProperty('--bg-color', '#000');
      document.documentElement.style.setProperty('--text-color', '#fff');
      document.documentElement.style.setProperty('--card-bg', '#111');
      document.documentElement.style.setProperty('--bar-clean', '#66ff66');
      document.documentElement.style.setProperty('--bar-defective', '#ff6666');
      document.documentElement.style.setProperty('--dot-clean', '#66ff66');
      document.documentElement.style.setProperty('--dot-defective', '#ff6666');
      document.documentElement.style.setProperty('--neon-clean', '#00ff00');
      document.documentElement.style.setProperty('--neon-defective', '#ff0000');
      break;
    case 'cyberpunk':
      document.documentElement.style.setProperty('--bg-color', '#0d0d0d');
      document.documentElement.style.setProperty('--text-color', '#0ff');
      document.documentElement.style.setProperty('--card-bg', '#111');
      document.documentElement.style.setProperty('--bar-clean', '#ff00ff');
      document.documentElement.style.setProperty('--bar-defective', '#00ffff');
      document.documentElement.style.setProperty('--dot-clean', '#ff00ff');
      document.documentElement.style.setProperty('--dot-defective', '#00ffff');
      document.documentElement.style.setProperty('--neon-clean', '#ff00ff');
      document.documentElement.style.setProperty('--neon-defective', '#00ffff');
      break;
    case 'solaris':
      document.documentElement.style.setProperty('--bg-color', '#fff4e0');
      document.documentElement.style.setProperty('--text-color', '#333');
      document.documentElement.style.setProperty('--card-bg', '#ffe6b3');
      document.documentElement.style.setProperty('--bar-clean', '#ffaa00');
      document.documentElement.style.setProperty('--bar-defective', '#ff3300');
      document.documentElement.style.setProperty('--dot-clean', '#ffaa00');
      document.documentElement.style.setProperty('--dot-defective', '#ff3300');
      document.documentElement.style.setProperty('--neon-clean', '#ffaa00');
      document.documentElement.style.setProperty('--neon-defective', '#ff3300');
      break;
  }
}

// --- History tracking ---
let calcCount = 0;

// --- Calculator ---
document.getElementById('odrForm').addEventListener('submit', function(e){
  e.preventDefault();
  const total = parseInt(document.getElementById('totalOrdersInput').value);
  const defective = parseInt(document.getElementById('defectiveOrdersInput').value);
  const target = parseFloat(document.getElementById('targetODRInput').value)/100;
  const type = displaySelect.value;

  if(defective > total){ alert("Defective orders cannot exceed total orders."); return; }

  const currentODR = (defective / total) * 100;
  const additionalOrders = Math.ceil((defective / target) - total);

  document.getElementById('results').innerHTML = `
    <p>Current ODR: <strong>${currentODR.toFixed(2)}%</strong></p>
    <p>Additional clean orders needed to reach target (${(target*100).toFixed(2)}%): <strong>${additionalOrders}</strong></p>
    <p>Tip: Resolve existing defective orders immediately to reduce ODR faster!</p>
  `;

  animateOrders(total, defective, type);

  // Add to history
  calcCount++;
  const tbody = document.getElementById('historyTable').querySelector('tbody');
  const timestamp = new Date().toLocaleString();
  const row = document.createElement('tr');
  row.innerHTML = `
    <td>${calcCount}</td>
    <td>${timestamp}</td>
    <td>${total}</td>
    <td>${defective}</td>
    <td>${(target*100).toFixed(2)}%</td>
    <td>${additionalOrders}</td>
  `;
  tbody.prepend(row);
});

// --- Download History ---
document.getElementById('downloadHistory').addEventListener('click', () => {
  const tbody = document.getElementById('historyTable').querySelector('tbody');
  if(!tbody.children.length){ alert("No history to download!"); return; }

  let content = '';
  Array.from(tbody.children).forEach(row => {
    const cols = Array.from(row.children).map(td => td.innerText).join(' | ');
    content += cols + '\n';
  });
  const blob = new Blob([content], { type: 'text/plain' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'odr_history.txt';
  a.click();
  URL.revokeObjectURL(url);
});

// --- Visitor tracking ---
let visits = parseInt(localStorage.getItem('visitorCount')) || 0;
visits++;
localStorage.setItem('visitorCount', visits);

// Hidden admin panel
const adminPanel = document.createElement('div');
adminPanel.style.display = 'none';
adminPanel.style.position = 'fixed';
adminPanel.style.bottom = '20px';
adminPanel.style.right = '20px';
adminPanel.style.background = '#000';
adminPanel.style.color = '#0f0';
adminPanel.style.padding = '15px';
adminPanel.style.borderRadius = '8px';
adminPanel.style.zIndex = '9999';
adminPanel.innerHTML = `
  <p>Visitors: <strong>${visits}</strong></p>
  <button id="downloadVisitors">Download</button>
`;
document.body.appendChild(adminPanel);

// Secret trigger: CTRL + SHIFT + V
document.addEventListener('keydown', (e) => {
  if (e.ctrlKey && e.shiftKey && e.key.toLowerCase() === 'v') {
    adminPanel.style.display =
      adminPanel.style.display === 'none' ? 'block' : 'none';
  }
});

// Download visitor count
document.getElementById('downloadVisitors').addEventListener('click', () => {
  const content = `Total visits: ${visits}\n`;
  const blob = new Blob([content], { type: 'text/plain' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'visitor_count.txt';
  a.click();
  URL.revokeObjectURL(url);
});
</script>
</body>
</html>
