<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Amazon ODR Visualization & Calculator</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
:root {
    --bg-color: #000;
    --text-color: #fff;
    --card-bg: #111;
    --bar-clean: #66ff66;
    --bar-defective: #ff6666;
    --dot-clean: #66ff66;
    --dot-defective: #ff6666;
    --neon-clean: #00ff00;
    --neon-defective: #ff0000;
    --btn-primary-bg: #2CFF05;
    --btn-primary-color: #000;
    --btn-success-bg: #2CFF05;
    --btn-success-color: #000;
    --offcanvas-bg: #111;
    --offcanvas-text: #fff;
    --offcanvas-table-header: #333;
    --offcanvas-table-row: #222;
}

body {
    font-family: Arial, sans-serif;
    background-color: var(--bg-color);
    color: var(--text-color);
    padding: 20px;
}

h1 {
    text-align: center;
}

h2 {
    text-align: center;
}

.top-row {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 20px;
    margin-bottom: 40px;
}

.calculator {
    background-color: var(--card-bg);
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    flex: 1 1 350px;
    min-width: 300px;
}

.text-section {
    background-color: var(--card-bg);
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    flex: 1 1 350px;
    min-width: 300px;
}

.animation-section {
    width: 100%;
    background-color: var(--card-bg);
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    text-align: center;
}

.bar-container {
    display: flex;
    align-items: flex-end;
    flex-wrap: wrap;
    max-width: 100%;
    margin: 0 auto;
    justify-content: center;
}

.bar {
    width: 20px;
    margin: 1px;
    transition: all 0.3s;
}

.bar.clean {
    background-color: var(--bar-clean);
}

.bar.defective {
    background-color: var(--bar-defective);
}

.dot {
    width: 15px;
    height: 15px;
    border-radius: 50%;
    display: inline-block;
    margin: 1px;
    transition: all 0.3s;
}

.dot.clean {
    background-color: var(--dot-clean);
}

.dot.defective {
    background-color: var(--dot-defective);
}

.neon-dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    display: inline-block;
    margin: 1px;
    transition: all 0.3s;
}

.neon-dot.clean {
    background-color: var(--neon-clean);
    box-shadow: 0 0 5px var(--neon-clean);
    box-shadow: 0 0 7px var(--neon-clean);
    box-shadow: 0 0 20px var(--neon-clean);
}

.neon-dot.defective {
    background-color: var(--neon-defective);
    box-shadow: 0 0 5px var(--neon-defective);
    box-shadow: 0 0 10px var(--neon-defective);
    box-shadow: 0 0 20px var(--neon-defective);
}

.highlight {
    color: var(--bar-defective);
    font-weight: bold;
}

.step {
    margin: 10px 0;
}

ul {
    padding-left: 20px;
}

.tiny-note {
    font-size: 0.8em;
    color: #aaa;
    margin-top: 2px;
}

.theme-select {
    display: flex;
    align-items: center;
    gap: 5px;
    margin-bottom: 10px;
}

input.form-control {
    background-color: var(--card-bg);
    color: var(--text-color);
    border: 1px solid #444;
    transition: all 0.3s;
}

input.form-control:focus {
    border-color: var(--bar-clean);
    box-shadow: 0 0 5px rgba(0,255,0,0.3);
}

select.form-select {
    background-color: var(--card-bg);
    color: var(--text-color);
    border: 1px solid #444;
    transition: all 0.3s;
}

select.form-select:focus {
    border-color: var(--bar-clean);
    box-shadow: 0 0 5px rgba(0,255,0,0.3);
}

textarea.form-control {
    background-color: var(--card-bg);
    color: var(--text-color);
    border: 1px solid #444;
    transition: all 0.3s;
}

textarea.form-control:focus {
    border-color: var(--bar-clean);
    box-shadow: 0 0 5px rgba(0,255,0,0.3);
}

button.btn {
    transition: all 0.3s;
    background-color: var(--btn-primary-bg);
    color: var(--btn-primary-color);
    border: none;
}

button.btn-success {
    background-color: var(--btn-success-bg);
    color: var(--btn-success-color);
}

.offcanvas {
    background-color: var(--offcanvas-bg);
    color: var(--offcanvas-text);
}

.offcanvas .table thead {
    background-color: var(--offcanvas-table-header);
    color: var(--offcanvas-text);
}

.offcanvas .table tbody tr {
    background-color: var(--offcanvas-table-row);
    color: var(--offcanvas-text);
}

.table th, .table td {
    white-space: nowrap;
}
</style>
</head>
<body>

<h1>Amazon ODR Visualization & Calculator</h1>

<div class="top-row">
<div class="calculator">
<h2>ODR Calculator</h2>

<div class="theme-select">
<label for="themeSelect">Theme:</label>
<select id="themeSelect" class="form-select">
<option value="light">ðŸŒž Light</option>
<option value="dark">ðŸŒš Dark</option>
<option value="cyberpunk">ðŸ¤– Cyberpunk</option>
<option value="solaris">ðŸŒ… Solaris</option>
</select>
<div class="tiny-note">Your choice will be remembered until cookies/cache are cleared.</div>
</div>

<form id="odrForm">
<label>Total Orders:</label>
<input type="number" id="totalOrdersInput" class="form-control" min="1" required>

<label>Defective Orders:</label>
<input type="number" id="defectiveOrdersInput" class="form-control" min="0" required>

<label>Target ODR (%):</label>
<input type="number" id="targetODRInput" class="form-control" min="0" max="100" step="0.01" value="1" required>

<label>Display Type:</label>
<select id="displayType" class="form-select mb-1">
<option value="bars">Bars</option>
<option value="dots">Dots</option>
<option value="neon">Glowing Neon Dots</option>
<option value="stacked">Stacked Blocks</option>
<option value="sparkline">Mini Sparkline</option>
<option value="heatmap">Heat Map</option>
</select>

<button type="submit" class="btn btn-success mt-2">Calculate</button>
</form>

<div class="results mt-3" id="results"></div>

<div class="mt-3 d-flex gap-2">
<button class="btn btn-primary" data-bs-toggle="offcanvas" data-bs-target="#historyDrawer">History</button>
<button id="downloadHistory" class="btn btn-success">Download History</button>
</div>
</div>

<div class="text-section">
<h2>Step-by-Step Explanation & Fix</h2>
<div class="info">
<div class="step"><strong>Step 1:</strong> Enter metrics to calculate ODR.</div>
<div class="step"><strong>Step 2:</strong> Formula: <span class="highlight">ODR = defective Ã· total Ã— 100%</span></div>
<div class="step"><strong>Step 3:</strong> Additional clean orders: <pre>ODR â‰¤ target â‡’ defective / (total + X) â‰¤ target</pre></div>
<div class="step"><strong>Step 4:</strong> Resolve defective orders ASAP.</div>
</div>
</div>
</div>

<div class="animation-section">
<h2 id="dynamicHeader">Orders Visualization</h2>
<div class="bar-container" id="barContainer"></div>
</div>

<div class="offcanvas offcanvas-start" tabindex="-1" id="historyDrawer">
<div class="offcanvas-header">
<h5 class="offcanvas-title">Calculation History</h5>
<button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas"></button>
</div>
<div class="offcanvas-body">
<table class="table table-striped" id="historyTable">
<thead>
<tr>
<th>#</th>
<th>Timestamp</th>
<th>Total Orders</th>
<th>Defective</th>
<th>Target ODR</th>
<th>Additional Orders Needed</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
const container = document.getElementById('barContainer');
const dynamicHeader = document.getElementById('dynamicHeader');
let bars = [];
let interval;

// Animate orders
function animateOrders(total, defective, type) {
    container.innerHTML = '';
    bars = [];
    clearInterval(interval);

    dynamicHeader.innerHTML = `You have <span style="color: var(--bar-defective)">${defective}</span> defective orders out of <span style="color: var(--bar-clean)">${total}</span>`;

    if(['bars','dots','neon'].includes(type)){
        for(let i=0;i<total;i++){
            const e = document.createElement('div');
            if(type==='bars'){
                e.classList.add('bar', i<defective?'defective':'clean');
                e.style.height='10px';
            } else if(type==='dots'){
                e.classList.add('dot', i<defective?'defective':'clean');
            } else if(type==='neon'){
                e.classList.add('neon-dot', i<defective?'defective':'clean');
            }
            container.appendChild(e);
            bars.push(e);
        }
        if(type==='bars'){
            let step = 0;
            interval = setInterval(()=>{
                if(step>=total){clearInterval(interval);return;}
                bars[step].style.height='20px';
                step++;
            },10);
        }
    } else if(type==='stacked'){
        for(let i=0;i<total;i++){
            const e = document.createElement('div');
            e.style.width='20px';
            e.style.height=`${10 + (i<defective?10:0)}px`;
            e.style.backgroundColor=i<defective?'var(--bar-defective)':'var(--bar-clean)';
            e.style.margin='1px';
            container.appendChild(e);
        }
    } else if(type==='sparkline'){
        const canvas = document.createElement('canvas');
        canvas.width = container.offsetWidth;
        canvas.height = 50;
        const ctx = canvas.getContext('2d');
        ctx.strokeStyle='var(--bar-clean)';
        ctx.beginPath();
        for(let i=0;i<total;i++){
            const x=i*(canvas.width/total);
            const y=50-(i<defective?40:20);
            if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
        }
        ctx.stroke();
        container.appendChild(canvas);
    } else if(type==='heatmap'){
        for(let i=0;i<total;i++){
            const e=document.createElement('div');
            e.style.width='15px';
            e.style.height='15px';
            e.style.margin='1px';
            const intensity=i<defective?1:0.3;
            e.style.backgroundColor=`rgba(255,0,0,${intensity})`;
            container.appendChild(e);
        }
    }
}

// Display type persistence
const displaySelect=document.getElementById('displayType');
const savedType=localStorage.getItem('displayType');
if(savedType) displaySelect.value=savedType;
displaySelect.addEventListener('change',()=>{
    localStorage.setItem('displayType', displaySelect.value);
});

// Theme switching
const themeSelect=document.getElementById('themeSelect');
let savedTheme=localStorage.getItem('theme')||'dark';
themeSelect.value=savedTheme;
setTheme(savedTheme);
themeSelect.addEventListener('change',()=>{
    setTheme(themeSelect.value);
    localStorage.setItem('theme', themeSelect.value);
});

function setTheme(theme){
    switch(theme){
        case 'light':
            document.documentElement.style.setProperty('--bg-color','#f0f4f8');
            document.documentElement.style.setProperty('--text-color','#000');
            document.documentElement.style.setProperty('--card-bg','#fff');
            document.documentElement.style.setProperty('--bar-clean','#4caf50');
            document.documentElement.style.setProperty('--bar-defective','#f44336');
            document.documentElement.style.setProperty('--dot-clean','#4caf50');
            document.documentElement.style.setProperty('--dot-defective','#f44336');
            document.documentElement.style.setProperty('--neon-clean','#00ff00');
            document.documentElement.style.setProperty('--neon-defective','#ff0000');
            document.documentElement.style.setProperty('--btn-primary-bg','#0d6efd');
            document.documentElement.style.setProperty('--btn-primary-color','#fff');
            document.documentElement.style.setProperty('--btn-success-bg','#198754');
            document.documentElement.style.setProperty('--btn-success-color','#fff');
            document.documentElement.style.setProperty('--offcanvas-bg','#fff');
            document.documentElement.style.setProperty('--offcanvas-text','#000');
            document.documentElement.style.setProperty('--offcanvas-table-header','#ccc');
            document.documentElement.style.setProperty('--offcanvas-table-row','#f9f9f9');
            break;
        case 'dark':
            document.documentElement.style.setProperty('--bg-color','#000');
            document.documentElement.style.setProperty('--text-color','#fff');
            document.documentElement.style.setProperty('--card-bg','#111');
            document.documentElement.style.setProperty('--bar-clean','#2CFF05');
            document.documentElement.style.setProperty('--bar-defective','#F20000');
            document.documentElement.style.setProperty('--dot-clean','#2CFF05');
            document.documentElement.style.setProperty('--dot-defective','#ff0000');
            document.documentElement.style.setProperty('--neon-clean','#2CFF05');
            document.documentElement.style.setProperty('--neon-defective','#ff0000');
            document.documentElement.style.setProperty('--btn-primary-bg','#2CFF05');
            document.documentElement.style.setProperty('--btn-primary-color','#000');
            document.documentElement.style.setProperty('--btn-success-bg','#2CFF05');
            document.documentElement.style.setProperty('--btn-success-color','#000');
            document.documentElement.style.setProperty('--offcanvas-bg','#111');
            document.documentElement.style.setProperty('--offcanvas-text','#fff');
            document.documentElement.style.setProperty('--offcanvas-table-header','#333');
            document.documentElement.style.setProperty('--offcanvas-table-row','#222');
            break;
        case 'cyberpunk':
            document.documentElement.style.setProperty('--bg-color','#0d0d0d');
            document.documentElement.style.setProperty('--text-color','#0ff');
            document.documentElement.style.setProperty('--card-bg','#111');
            document.documentElement.style.setProperty('--bar-clean','#ff00ff');
            document.documentElement.style.setProperty('--bar-defective','#00ffff');
            document.documentElement.style.setProperty('--dot-clean','#ff00ff');
            document.documentElement.style.setProperty('--dot-defective','#00ffff');
            document.documentElement.style.setProperty('--neon-clean','#ff00ff');
            document.documentElement.style.setProperty('--neon-defective','#00ffff');
            document.documentElement.style.setProperty('--btn-primary-bg','#ff00ff');
            document.documentElement.style.setProperty('--btn-primary-color','#000');
            document.documentElement.style.setProperty('--btn-success-bg','#00ffff');
            document.documentElement.style.setProperty('--btn-success-color','#000');
            document.documentElement.style.setProperty('--offcanvas-bg','#111');
            document.documentElement.style.setProperty('--offcanvas-text','#0ff');
            document.documentElement.style.setProperty('--offcanvas-table-header','#222');
            document.documentElement.style.setProperty('--offcanvas-table-row','#111');
            break;
        case 'solaris':
            document.documentElement.style.setProperty('--bg-color','#fff4e0');
            document.documentElement.style.setProperty('--text-color','#333');
            document.documentElement.style.setProperty('--card-bg','#ffe6b3');
            document.documentElement.style.setProperty('--bar-clean','#ffaa00');
            document.documentElement.style.setProperty('--bar-defective','#ff3300');
            document.documentElement.style.setProperty('--dot-clean','#ffaa00');
            document.documentElement.style.setProperty('--dot-defective','#ff3300');
            document.documentElement.style.setProperty('--neon-clean','#ffaa00');
            document.documentElement.style.setProperty('--neon-defective','#ff3300');
            document.documentElement.style.setProperty('--btn-primary-bg','#ff9900');
            document.documentElement.style.setProperty('--btn-primary-color','#000');
            document.documentElement.style.setProperty('--btn-success-bg','#ff6600');
            document.documentElement.style.setProperty('--btn-success-color','#fff');
            document.documentElement.style.setProperty('--offcanvas-bg','#ffe6b3');
            document.documentElement.style.setProperty('--offcanvas-text','#333');
            document.documentElement.style.setProperty('--offcanvas-table-header','#ffcc99');
            document.documentElement.style.setProperty('--offcanvas-table-row','#ffddb3');
            break;
    }
}

// Calculator and history
let calcCount=0;
const tbody=document.getElementById('historyTable').querySelector('tbody');

document.getElementById('odrForm').addEventListener('submit', e=>{
    e.preventDefault();

    const total = parseInt(document.getElementById('totalOrdersInput').value);
    const defective = parseInt(document.getElementById('defectiveOrdersInput').value);
    const target = parseFloat(document.getElementById('targetODRInput').value)/100;
    const type = displaySelect.value;

    if(defective>total){
        alert("Defective orders cannot exceed total orders.");
        return;
    }

    const currentODR = (defective/total)*100;
    const additionalOrders = Math.ceil((defective/target)-total);

    document.getElementById('results').innerHTML=`
        <p>Current ODR: <strong>${currentODR.toFixed(2)}%</strong></p>
        <p>Additional clean orders to reach target (${(target*100).toFixed(2)}%): <strong>${additionalOrders}</strong></p>
    `;

    animateOrders(total, defective, type);

    calcCount++;
    const timestamp = new Date().toLocaleString();
    const row = document.createElement('tr');
    row.innerHTML = `
        <td>${calcCount}</td>
        <td>${timestamp}</td>
        <td>${total}</td>
        <td>${defective}</td>
        <td>${(target*100).toFixed(2)}%</td>
        <td>${additionalOrders}</td>
    `;
    tbody.appendChild(row);
});

// Download history
document.getElementById('downloadHistory').addEventListener('click', ()=>{
    let csv = 'No,Timestamp,Total Orders,Defective,Target ODR,Additional Orders\n';
    Array.from(tbody.querySelectorAll('tr')).forEach(tr=>{
        const tds = tr.querySelectorAll('td');
        csv += Array.from(tds).map(td=>td.textContent).join(',')+'\n';
    });
    const blob = new Blob([csv], {type:'text/csv'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'odr_history.csv';
    a.click();
    URL.revokeObjectURL(url);
});
</script>

</body>
</html>
